<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Training Dashboard - TonAI</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <img src="static/logo_notext.png" alt="TonAI Logo" class="brand-logo-small" />
                <div>
                    <h1>Model Training Dashboard</h1>
                    <p class="subtitle">Manage models and training jobs</p>
                </div>
            </div>
            <div class="header-right">
                <a href="index.html" class="btn-secondary btn-sm">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                    Back to Stream
                </a>
            </div>
        </header>

        <!-- System Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon gpu">üéÆ</div>
                <div class="stat-content">
                    <div class="stat-label">GPU</div>
                    <div class="stat-value" id="gpu-status">Loading...</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon cpu">‚ö°</div>
                <div class="stat-content">
                    <div class="stat-label">CPU</div>
                    <div class="stat-value" id="cpu-usage">--%</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon memory">üíæ</div>
                <div class="stat-content">
                    <div class="stat-label">RAM</div>
                    <div class="stat-value" id="ram-usage">--%</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon storage">üìÅ</div>
                <div class="stat-content">
                    <div class="stat-label">Storage</div>
                    <div class="stat-value" id="storage-free">-- GB Free</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="dashboard-main">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="models">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>
                    </svg>
                    Model Library
                </button>
                <button class="tab-btn" data-tab="training">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M2 12h20"/>
                    </svg>
                    Training
                </button>
                <button class="tab-btn" data-tab="jobs">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    Training Jobs
                </button>
                <button class="tab-btn" data-tab="system">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="2"/>
                        <path d="M12 6v2M12 16v2M6 12h2M16 12h2"/>
                    </svg>
                    System Info
                </button>
            </div>

            <!-- Tab Contents -->
            <div class="tab-content active" id="models-tab">
                <div class="content-header">
                    <h2>Model Library</h2>
                    <button class="btn-primary" onclick="refreshModels()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                        Refresh
                    </button>
                </div>
                
                <div class="filter-bar">
                    <input type="text" id="model-search" placeholder="Search models..." class="search-input">
                    <select id="category-filter" class="filter-select">
                        <option value="all">All Categories</option>
                        <option value="vehicle">Vehicle</option>
                        <option value="plate">Plate</option>
                        <option value="ocr">OCR</option>
                        <option value="tracking">Tracking</option>
                    </select>
                </div>

                <div id="models-grid" class="models-grid">
                    <!-- Models will be loaded here -->
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <div class="tab-content" id="training-tab">
                <div class="content-header">
                    <h2>Start New Training</h2>
                </div>

                <div class="training-form">
                    <div class="form-section">
                        <h3>Job Configuration</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="job-name">Job Name *</label>
                                <input type="text" id="job-name" placeholder="my_training_job" required>
                            </div>
                            <div class="form-group">
                                <label for="model-type">Model Architecture *</label>
                                <select id="model-type" required>
                                    <option value="">Select model...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Dataset Configuration (Roboflow)</h3>

                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="rf-api-key">Roboflow API Key *</label>
                                <input type="password" id="rf-api-key" placeholder="Your Roboflow API key" required>
                                <small>Get your API key from <a href="https://app.roboflow.com/settings/api" target="_blank">Roboflow Settings</a></small>
                            </div>
                            <div class="form-group">
                                <label for="rf-workspace">Workspace *</label>
                                <input type="text" id="rf-workspace" placeholder="your-workspace" required>
                            </div>
                            <div class="form-group">
                                <label for="rf-project">Project *</label>
                                <input type="text" id="rf-project" placeholder="license-plate-detection" required>
                            </div>
                            <div class="form-group">
                                <label for="rf-version">Version *</label>
                                <input type="number" id="rf-version" placeholder="1" min="1" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Training Parameters</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="epochs">Epochs</label>
                                <input type="number" id="epochs" value="100" min="1">
                            </div>
                            <div class="form-group">
                                <label for="batch-size">Batch Size</label>
                                <input type="number" id="batch-size" value="16" min="1">
                            </div>
                            <div class="form-group">
                                <label for="image-size">Image Size</label>
                                <input type="number" id="image-size" value="640" step="32">
                            </div>
                            <div class="form-group">
                                <label for="device">Device</label>
                                <select id="device">
                                    <option value="0">GPU 0</option>
                                    <option value="cpu">CPU</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="workers">Workers</label>
                                <input type="number" id="workers" value="8" min="1">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-secondary" onclick="resetTrainingForm()">Reset</button>
                        <button class="btn-primary btn-lg" onclick="startTraining()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Start Training
                        </button>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="jobs-tab">
                <div class="content-header">
                    <h2>Training Jobs</h2>
                    <button class="btn-primary" onclick="refreshJobs()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div id="jobs-list" class="jobs-list">
                    <!-- Jobs will be loaded here -->
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <div class="tab-content" id="system-tab">
                <div class="content-header">
                    <h2>System Information</h2>
                    <button class="btn-primary" onclick="refreshSystemInfo()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div class="system-info-grid">
                    <div class="info-section">
                        <h3>GPU Information</h3>
                        <div id="gpu-info" class="info-content">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>Storage Information</h3>
                        <div id="storage-info" class="info-content">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>System Metrics</h3>
                        <div id="metrics-info" class="info-content">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Details Modal -->
    <div id="job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-job-name">Job Details</h2>
                <button class="modal-close" onclick="closeJobModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="job-progress-section">
                    <div class="progress-info">
                        <span id="modal-job-status" class="status-badge">Running</span>
                        <span id="modal-job-progress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="modal-progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="epoch-info">
                        <span>Epoch: <strong id="modal-epoch">0</strong> / <strong id="modal-total-epochs">100</strong></span>
                    </div>
                </div>

                <div class="logs-section">
                    <h3>Training Logs</h3>
                    <div id="modal-logs" class="logs-container">
                        <!-- Logs will appear here -->
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" onclick="downloadJobLogs()">Download Logs</button>
                    <button class="btn-danger" id="cancel-job-btn" onclick="cancelJob()">Cancel Job</button>
                    <button class="btn-primary" id="close-modal-btn" onclick="closeJobModal()" style="display:none;">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
